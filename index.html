<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RD Engenharia | Sistema de Engenharia</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  
  <style>
    :root { --primary: #0a7cff; --secondary: #25d366; --danger: #e74c3c; --bg: #f2f6fa; --text: #333; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
    header { background: var(--primary); color: white; padding: 15px; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .logo-container img { max-height: 60px; width: auto; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .view { display: none; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .active-view { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    .menu-card { background: white; padding: 40px 20px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px solid #eee; transition: 0.3s; }
    .menu-card:hover { transform: translateY(-5px); border-color: var(--primary); }
    .menu-card i { font-size: 3rem; color: var(--primary); margin-bottom: 15px; display: block; }
    .section-box { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa; }
    h4 { margin: 0 0 10px 0; color: #555; text-transform: uppercase; font-size: 0.75rem; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    .btn-back { background: #eee; padding: 8px 15px; border-radius: 20px; cursor: pointer; display: inline-block; margin-bottom: 15px; font-weight: bold; font-size: 0.8rem; }
    input, select, button { width: 100%; padding: 12px; margin-top: 8px; font-size: 1rem; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
    .grid-flex { display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-end; }
    .grid-flex > div { flex: 1; min-width: 120px; }
    button.main-btn { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; padding: 15px; }
    .btn-add { background: #6c757d; color: white; padding: 10px; border: none; cursor: pointer; border-radius: 5px; width: auto; }
    .summary-box { background: #fff; padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 5px solid var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .item-list { font-size: 0.9rem; border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
    .btn-del { color: var(--danger); cursor: pointer; }
    .total-row { margin-top:15px; font-weight:bold; font-size: 1.2rem; color: var(--primary); border-top: 1px dashed #ccc; padding-top: 10px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<header>
  <div class="logo-container">
    <img src="logo.png" alt="RD Engenharia" onerror="this.style.display='none'">
  </div>
  <div style="font-weight: bold; font-size: 1.3rem;">RD ENGENHARIA ELÉTRICA</div>
</header>

<div class="container">
  <div id="view-menu" class="active-view">
    <div class="menu-grid">
      <div class="menu-card" onclick="showView('view-orcamento')">
        <i class="fas fa-file-invoice-dollar"></i>
        <span>Novo Orçamento</span>
      </div>
      <div class="menu-card" onclick="window.open('https://wa.me/73991317853')">
        <i class="fab fa-whatsapp"></i>
        <span>Suporte Técnico</span>
      </div>
    </div>
  </div>

  <div id="view-orcamento" class="view">
    <div class="btn-back" onclick="showView('view-menu')"><i class="fas fa-arrow-left"></i> Voltar</div>
    <h2><i class="fas fa-calculator"></i> Orçamento Técnico</h2>
    
    <div class="section-box">
      <h4>Dados do Cliente</h4>
      <div class="grid-flex">
        <div style="flex: 2;"><label>Cliente:</label><input type="text" id="orc-cliente" placeholder="Nome"></div>
        <div><label>Validade (Dias):</label><input type="number" id="orc-validade" value="5"></div>
      </div>
    </div>

    <div class="section-box">
      <h4>Dados da Instalação</h4>
      <div class="grid-flex">
        <div><label>Padrão:</label><select id="padrao" onchange="atualizarOpcoesTensao()"><option value="1">Monofásico</option><option value="2">Bifásico</option><option value="3">Trifásico</option></select></div>
        <div><label>Tensão:</label><select id="tensao"><option value="127">127V (F+N)</option><option value="220">220V (F+N ou F+F)</option></select></div>
        <div><label>Dist. Padrão ao QDC (m):</label><input type="number" id="dist-geral" value="10"></div>
      </div>
    </div>

    <div class="section-box">
      <h4>Pontos de Uso Geral</h4>
      <div class="grid-flex">
        <div style="flex: 2;"><label>Item:</label><select id="tipo-ponto" onchange="togglePotenciaField()"><option value="luz" data-preco="25">Ponto de Luz</option><option value="tug" data-preco="45">Tomada (TUG)</option><option value="tug_dupla" data-preco="65">Tomada Dupla (TUG)</option><option value="int_simples" data-preco="35" data-is-switch="true">Interruptor Simples</option><option value="aterramento" data-preco="200">Aterramento (Haste)</option></select></div>
        <div id="container-potencia"><label>Watts:</label><input type="number" id="ponto-pot" value="100"></div>
        <div><label>Qtd:</label><input type="number" id="ponto-qtd" value="1"></div>
        <button class="btn-add" onclick="addItem()">+ Add</button>
      </div>
    </div>

    <div class="section-box">
      <h4>Cargas Especiais (TUE)</h4>
      <div class="grid-flex">
        <div style="flex: 2;"><label>Equipamento:</label><select id="tue-select" onchange="toggleTueManual()"><option value="chuveiro">Chuveiro</option><option value="ar_cond">Ar Condicionado</option><option value="outro">Outro</option></select></div>
        <div id="div-tue-btu" class="hidden"><label>BTUs:</label><select id="tue-btu"><option value="9000">9.000</option><option value="12000">12.000</option><option value="18000">18.000</option></select></div>
        <div id="div-tue-manual"><label>Watts:</label><input type="number" id="tue-pot" value="5500"></div>
        <div><label>Dist.(m):</label><input type="number" id="tue-dist" value="15"></div>
        <button class="btn-add" onclick="addTUE()">+ TUE</button>
      </div>
      <div id="div-tue-nome" class="hidden"><label>Nome:</label><input type="text" id="tue-nome-custom" placeholder="Ex: Forno"></div>
    </div>

    <div class="summary-box">
      <h4>Resumo da Proposta</h4>
      <div id="lista-itens"></div>
      <div id="calculo-detalhes" style="margin-top:10px; font-size:0.85rem; color:#666;"></div>
      <div class="total-row"><span>Total:</span> <span id="valor-total">R$ 0,00</span></div>
    </div>

    <button class="main-btn" onclick="gerarPDF()">GERAR PDF COMPLETO</button>
  </div>
</div>

<script>
  let itens = [];
  const PRECO_MONTAGEM_CIRCUITO = 150.00;
  const PRECO_DISJUNTOR_PADRAO = 80.00;
  
  const TABELA_AR = { 9000: { w: 1300 }, 12000: { w: 1600 }, 18000: { w: 2600 } };

  function showView(viewId) {
    document.querySelectorAll('.view, #view-menu').forEach(v => v.classList.remove('active-view'));
    document.getElementById(viewId).classList.add('active-view');
  }

  function atualizarOpcoesTensao() {
    const p = document.getElementById('padrao').value;
    const s = document.getElementById('tensao');
    s.innerHTML = (p === "3") ? '<option value="220">220V</option><option value="380">380V</option>' : '<option value="127">127V</option><option value="220">220V</option>';
  }

  function toggleTueManual() {
    const val = document.getElementById('tue-select').value;
    document.getElementById('div-tue-manual').className = (val === 'ar_cond') ? 'hidden' : '';
    document.getElementById('div-tue-btu').className = (val === 'ar_cond') ? '' : 'hidden';
    document.getElementById('div-tue-nome').className = (val === 'outro') ? '' : 'hidden';
  }

  function togglePotenciaField() {
    const sel = document.getElementById('tipo-ponto');
    const isSpecial = sel.options[sel.selectedIndex].dataset.isSwitch === "true" || sel.value === 'aterramento';
    document.getElementById('container-potencia').className = isSpecial ? 'hidden' : '';
  }

  function addItem() {
    const sel = document.getElementById('tipo-ponto');
    const opt = sel.options[sel.selectedIndex];
    const qtd = parseInt(document.getElementById('ponto-qtd').value) || 0;
    const pot = (opt.dataset.isSwitch !== "true" && opt.value !== 'aterramento') ? (parseInt(document.getElementById('ponto-pot').value) || 0) : 0;
    
    if(qtd > 0) {
      itens.push({ id: Date.now(), desc: `${qtd}x ${opt.text}`, preco: parseFloat(opt.dataset.preco) * qtd, potencia: pot * qtd, categoria: opt.value === 'aterramento' ? 'ATERRAMENTO' : (opt.value.includes('luz') ? 'LUZ' : 'TUG'), qtd: qtd, tipo: opt.value });
      atualizar();
    }
  }

  function addTUE() {
    const tipo = document.getElementById('tue-select').value;
    const dist = parseFloat(document.getElementById('tue-dist').value) || 0;
    let pot = (tipo === 'ar_cond') ? TABELA_AR[document.getElementById('tue-btu').value].w : parseFloat(document.getElementById('tue-pot').value);
    let nome = (tipo === 'ar_cond') ? `Ar Cond. ${document.getElementById('tue-btu').value} BTU` : (tipo === 'chuveiro' ? 'Chuveiro' : document.getElementById('tue-nome-custom').value);

    itens.push({ id: Date.now(), desc: `TUE: ${nome} (${pot}W)`, preco: 250, potencia: pot, categoria: 'TUE', subcategoria: tipo, distancia: dist, nomeTUE: nome, qtd: 1 });
    atualizar();
  }

  function excluir(id) {
    itens = itens.filter(i => i.id !== id);
    atualizar();
  }

  function atualizar() {
    const lista = document.getElementById('lista-itens');
    lista.innerHTML = '';
    let totalMO = 0;
    
    itens.forEach(i => {
      totalMO += i.preco;
      lista.innerHTML += `<div class="item-list"><span>${i.desc}</span><span>R$ ${i.preco.toFixed(2)} <i class="fas fa-trash-alt btn-del" onclick="excluir(${i.id})"></i></span></div>`;
    });

    const numCirc = Math.max(1, itens.filter(i => i.categoria === 'TUE').length + 2);
    const montagem = (numCirc * PRECO_MONTAGEM_CIRCUITO) + PRECO_DISJUNTOR_PADRAO;
    
    document.getElementById('calculo-detalhes').innerHTML = `Circuitos: ${numCirc} | Montagem QDC: R$ ${montagem.toFixed(2)}`;
    document.getElementById('valor-total').innerText = `R$ ${(totalMO + montagem).toLocaleString('pt-BR')}`;
  }

  async function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const cliente = document.getElementById('orc-cliente').value || "Cliente";
    
    // Página 1: Capa e Mão de Obra
    doc.setFontSize(16); doc.setTextColor(10, 124, 255);
    doc.text("ORÇAMENTO TÉCNICO - RD ENGENHARIA", 105, 20, { align: "center" });
    
    doc.setFontSize(10); doc.setTextColor(0);
    doc.text(`Cliente: ${cliente}`, 20, 35);
    doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 20, 40);

    const bodyMO = itens.map(i => [i.desc, `R$ ${i.preco.toFixed(2)}`]);
    doc.autoTable({ startY: 50, head: [['Serviço', 'Preço']], body: bodyMO, headStyles: { fillColor: [10, 124, 255] } });

    // Página 2: Materiais (Simplificado para o exemplo)
    doc.addPage();
    doc.text("LISTA DE MATERIAIS SUGERIDA (NBR 5410)", 20, 20);
    
    const materiais = [
      ["Cabo Flexível 2,5mm²", "Preto", "50m"],
      ["Cabo Flexível 2,5mm²", "Azul", "30m"],
      ["Disjuntor DIN 20A", "Unipolar", "2 un"],
      ["IDR 30mA", "Geral", "1 un"]
    ];
    
    doc.autoTable({ startY: 30, head: [['Item', 'Tipo', 'Qtd']], body: materiais, headStyles: { fillColor: [37, 211, 102] } });

    doc.save(`Orcamento_RD_${cliente}.pdf`);
  }
</script>
</body>
</html>
